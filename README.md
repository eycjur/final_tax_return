# 確定申告収支記録アプリケーション

個人事業主・フリーランス向けの確定申告用収支記録アプリケーションです。

## 機能

### 基本機能
- ✅ 収入・支出の記録
- ✅ 日本円(JPY)・米ドル(USD)対応
- ✅ TTM（電信仲値）による自動円換算
- ✅ 源泉徴収の管理（自動計算対応）
- ✅ 按分機能（家賃、通信費などの経費按分）

### ファイル管理
- ✅ PDF・画像ファイルのアップロード
- ✅ スマホカメラでの撮影
- ✅ 年度ごとのファイル保存（Google Drive連携用）

### AI機能
- ✅ Gemini APIによる領収書・請求書の自動解析
- ✅ 日付・金額・取引先の自動抽出

### レポート機能
- ✅ 年間サマリー（収入・経費・所得）
- ✅ カテゴリ別集計
- ✅ 取引先別集計（支払調書照合用）
- ✅ 月別推移グラフ
- ✅ CSVエクスポート

## インストール

[uv](https://docs.astral.sh/uv/) を使用してパッケージ管理を行います。

```bash
# uvがインストールされていない場合
curl -LsSf https://astral.sh/uv/install.sh | sh

# プロジェクトディレクトリに移動
cd final_tax_return

# 依存パッケージをインストール
uv sync
```

## 使い方

### アプリケーションの起動

```bash
uv run python app.py
```

または、スクリプトエントリポイントを使用:

```bash
uv run tax-app
```

ブラウザで `http://localhost:8050` を開いてください。

### 基本的な使い方

1. **ダッシュボード**: 年度を選択して収支サマリーを確認
2. **記録一覧**: 「新規記録」ボタンで収支を入力
3. **レポート**: 確定申告用のカテゴリ別・取引先別集計を確認
4. **設定**: Gemini APIキーや按分率のプリセットを設定

### Gemini APIの設定

1. [Google AI Studio](https://aistudio.google.com/) でAPIキーを取得
2. 設定画面でAPIキーを入力して保存
3. 記録入力時に「Geminiで自動入力」ボタンが利用可能に

### 添付ファイルの管理

- 添付ファイルは `attachments/{年度}/` ディレクトリに保存
- このディレクトリをGoogle Driveにアップロードして証跡管理
- ファイル名は `{日付}_{種別}_{時刻}.{拡張子}` 形式

## ディレクトリ構造

```
final_tax_return/
├── app.py                  # Dashアプリケーション初期化
├── index.py                # メインエントリーポイント・ルーティング
├── pyproject.toml          # プロジェクト設定・依存パッケージ
├── uv.lock                 # 依存パッケージのロックファイル
├── .env.example            # 環境変数のサンプル
├── data/
│   └── tax_records.db      # SQLiteデータベース
├── attachments/            # 添付ファイル保存
│   ├── 2024/
│   ├── 2025/
│   └── 2026/
├── assets/
│   ├── style.css           # スタイルシート
│   ├── camera.js           # カメラ機能
│   └── crypto.js           # APIキー暗号化
├── pages/                  # ページコンポーネント
│   ├── records.py          # 記録一覧・入力フォーム
│   ├── report.py           # レポート・集計画面
│   └── settings.py         # 設定画面
├── components/             # 共通コンポーネント
│   └── common.py           # ナビゲーションバーなど
└── utils/
    ├── database.py         # データベース操作
    ├── calculations.py     # 計算ロジック（TTM換算、源泉徴収など）
    └── gemini.py           # Gemini API連携
```

## 確定申告での利用

### 収入の記録
- 請求書発行時に記録
- 源泉徴収がある場合はチェックを入れる
- USD収入の場合は入金日のTTMを記録

### 経費の記録
- 按分が必要な経費（家賃、通信費など）は按分率を設定
- 領収書をアップロードまたは撮影して添付

### レポート出力
- 確定申告時に「レポート」画面で集計を確認
- CSVダウンロードでExcelでの加工も可能

## 注意事項

- このアプリケーションは記録・集計の補助ツールです
- 最終的な確定申告は税理士への相談を推奨します
- データのバックアップは定期的に行ってください
